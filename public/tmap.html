<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<title>simpleMap</title>
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap-theme.min.css">
	<script src="//code.jquery.com/jquery-1.11.0.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
	<script src="https://apis.skplanetx.com/tmap/js?version=1&format=javascript&appKey=2447e707-af39-327f-ac4c-78189ebfd9f9"></script>
	<script src="lib/jquery-3.1.1.min.js"></script>
	<!-- <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script> -->
	<script type="text/javascript">
		var map;
		var appKey = "2447e707-af39-327f-ac4c-78189ebfd9f9";
			//초기화 함수
			function initTmap(){
				map = new Tmap.Map({div:'map_div',
					width:'100%',
					height:'70%',
					transitionEffect:"resize",
					animation:true
				});
				document.getElementById("route").addEventListener("click", function(){
					parseLocation(document.getElementById("start").value, document.getElementById("end").value, searchRoute);
				});

				$('#destinationDialog').modal('show');
			};

			function parseLocation(address1, address2, callback){
				var urlStr = "https://apis.skplanetx.com/tmap/geo/fullAddrGeo?version=1&format=json&addressFlag=F00";
				urlStr += "&appKey=" + appKey;
				urlStr += "&fullAddr=";
				$.getJSON(urlStr + address1, function(result1){
					var coord1 = result1.coordinateInfo.coordinate[0];
					console.log(coord1);
					$.getJSON(urlStr + address2, function(result2){
						var coord2 = result2.coordinateInfo.coordinate[0];
						console.log(coord2);
						callback(coord1.newLon, coord1.newLat, coord2.newLon, coord2.newLat);
					});
				});
			}
			var routeLayer;
			//경로 정보 로드
			function searchRoute(startX, startY, endX, endY){
				if(routeLayer) map.removeLayer(routeLayer);
				try{
					var routeFormat = new Tmap.Format.KML({extractStyles:true, extractAttributes:true});
					var urlStr = "https://apis.skplanetx.com/tmap/routes?version=1&format=xml";
					urlStr += "&startX="+startX;
					urlStr += "&startY="+startY;
					urlStr += "&endX="+endX;
					urlStr += "&endY="+endY;
					urlStr += "&appKey="+appKey;
					var prtcl = new Tmap.Protocol.HTTP({
						url: urlStr,
						format:routeFormat
					});
					routeLayer = new Tmap.Layer.Vector("route", {protocol:prtcl, strategies:[new Tmap.Strategy.Fixed()]});
					routeLayer.events.register("featuresadded", routeLayer, onDrawnFeatures);
					map.addLayer(routeLayer);
				} catch(error){
					console.log(error);
				}
			}
			//경로 그리기 후 해당영역으로 줌
			function onDrawnFeatures(e){
				map.zoomToExtent(this.getDataExtent());
			}
		</script>
	</head>
	<body onload="initTmap()">
		<!-- 상단 네비게이션 바 -->
		<div class="navbar navbar-inverse navbar-fixed-top">
			<div class="container">
				<div class="navbar-header">
					<!-- 브라우저가 좁아졋을때 나오는 버튼(클릭시 메뉴출력) -->
					<button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
					</button>
					<a class="navbar-brand" href="#">WayKnower</a>
				</div>
				<div class="collapse navbar-collapse">
					<ul class="nav navbar-nav">
						<li class="active"><a href="#"> 메인화면</a></li>
						<li><a href="#about">길찾기</a></li>
						<li><a href="#contact">문의하기</a></li>
					</ul>
				</div>
			</div>
		</div>
		<div id="map_div" style="z-index: 1500;"></div>
		<div id="panel">
			<div id="destinationDialog" class="modal-dialog modal-xl">
				<div class="modal-content">
					<div class="modal-header">
						<h4 class="modal-title">경로지 입력</h4>
					</div>
					<div class="modal-body">
						<b>출발지: </b>
						<input type="text" id="start" value="서울시 중구 명동길 74"s/>
						<br/>
						<b>도착지: </b>
						<input type="text" id="end" value="서울특별시 송파구 올림픽로35길 123 향군타워"/>
					</div>
					<div class="modal-footer">
						<strong>Mode of Travel: </strong>
						<select id="mode">
							<option value="DRIVING">Driving</option>
						</select>
						<button  type="button" class="btn btn-primary" id="route">길찾기</button>
					</div>
				</div>
			</div>
		</div>
	</body>
	</html>
